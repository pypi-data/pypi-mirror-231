[tox]
minversion = 3.1
envlist = py3,coverage,pep8

[testenv]
deps =
  -r test-requirements.txt
commands =
  pytest wsme/tests tests/pecantest tests/test_sphinxext.py tests/test_flask.py

[testenv:coverage]
commands =
  coverage erase
  pytest --cov=wsme --cov=wsme_ext wsme/tests tests/pecantest tests/test_sphinxext.py tests/test_flask.py
  coverage combine
  coverage xml --include="wsme/*.py","wsme/rest/*.py","wsmeext/*.py" --omit "wsme/tests/*"
  coverage report --show-missing --include="wsme/*.py","wsme/rest/*.py","wsmeext/*.py" --omit "wsme/tests/*"

[testenv:docs]
allowlist_externals =
  rm
deps =
  -r doc/requirements.txt
commands =
  rm -fr doc/build
  sphinx-build -W -b html doc/source doc/build/html

[testenv:pep8]
deps = flake8
commands =
  flake8 wsme wsmeext setup.py

[testenv:venv]
usedevelop = True
commands = {posargs}
