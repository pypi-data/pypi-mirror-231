"use strict";(self.webpackChunkjupyterlab_pioneer=self.webpackChunkjupyterlab_pioneer||[]).push([[798],{798:(e,t,n)=>{n.r(t),n.d(t,{default:()=>C});var o=n(829),i=n(65),s=n(856);async function l(e="",t={}){const n=s.ServerConnection.makeSettings(),o=i.URLExt.join(n.baseUrl,"jupyterlab-pioneer",e);let l;try{l=await s.ServerConnection.makeRequest(o,t,n)}catch(e){throw new s.ServerConnection.NetworkError(e)}let a=await l.text();if(a.length>0)try{a=JSON.parse(a)}catch(e){console.log("Not a JSON response body.",l)}if(!l.ok)throw new s.ServerConnection.ResponseError(l,a.message||a);return a}class a{async loadNotebookPanel(e){this.notebookPanel=e}async publishEvent(e,t){var n,o,i,s,a,d,c;if(!this.notebookPanel)throw Error("router needs to load notebookPanel first.");this.sessionID&&this.sessionID===(null===(o=null===(n=this.notebookPanel)||void 0===n?void 0:n.sessionContext.session)||void 0===o?void 0:o.id)||(this.sessionID=null===(s=null===(i=this.notebookPanel)||void 0===i?void 0:i.sessionContext.session)||void 0===s?void 0:s.id);const v={eventDetail:e,notebookState:{sessionID:this.sessionID,notebookPath:null===(a=this.notebookPanel)||void 0===a?void 0:a.context.path,notebookContent:t?null===(c=null===(d=this.notebookPanel)||void 0===d?void 0:d.model)||void 0===c?void 0:c.toJSON():null}},r=await l("export",{method:"POST",body:JSON.stringify(v)});console.log(r)}}class d{constructor(){this.produced=!1}async listen(e,t,n){if(!this.produced){const e={eventName:d.id,eventTime:Date.now(),eventInfo:{environ:await l("environ")}};await t.publishEvent(e,n),this.produced=!0}}}d.id="NotebookOpenEvent";const c=e=>{const t=[];for(let n=0;n<e.content.widgets.length;n++){const o=e.content.widgets[n],i=o.node.offsetTop,s=o.node.offsetTop+o.node.offsetHeight,l=e.content.node.scrollTop;i<=e.content.node.scrollTop+e.content.node.clientHeight&&s>=l&&t.push({id:o.model.id,index:n})}return t};class v{constructor(){this.timeout=0}listen(e,t,n){e.content.node.addEventListener("scroll",(async o=>{o.stopPropagation(),clearTimeout(this.timeout),await new Promise((e=>this.timeout=window.setTimeout(e,1500)));const i={eventName:v.id,eventTime:Date.now(),eventInfo:{cells:c(e)}};await t.publishEvent(i,n)}))}}v.id="NotebookScrollEvent";class r{listen(e,t,n){document.addEventListener("visibilitychange",(async()=>{if("visible"===document.visibilityState){const o={eventName:r.id,eventTime:Date.now(),eventInfo:{cells:c(e)}};await t.publishEvent(o,n)}}))}}r.id="NotebookVisibleEvent";class u{listen(e,t,n){document.addEventListener("visibilitychange",(async e=>{if("hidden"===document.visibilityState){const e={eventName:u.id,eventTime:Date.now()};await t.publishEvent(e,n)}}))}}u.id="NotebookHiddenEvent";class w{listen(e,t,n){e.node.addEventListener("copy",(async()=>{var o,i;const s={id:null===(o=e.content.activeCell)||void 0===o?void 0:o.model.id,index:e.content.widgets.findIndex((t=>t===e.content.activeCell))},l=null===(i=document.getSelection())||void 0===i?void 0:i.toString(),a={eventName:w.id,eventTime:Date.now(),eventInfo:{cells:[s],selection:l}};await t.publishEvent(a,n)}))}}w.id="ClipboardCopyEvent";class b{listen(e,t,n){e.node.addEventListener("cut",(async()=>{var o,i;const s={id:null===(o=e.content.activeCell)||void 0===o?void 0:o.model.id,index:e.content.widgets.findIndex((t=>t===e.content.activeCell))},l=null===(i=document.getSelection())||void 0===i?void 0:i.toString(),a={eventName:b.id,eventTime:Date.now(),eventInfo:{cells:[s],selection:l}};await t.publishEvent(a,n)}))}}b.id="ClipboardCutEvent";class h{listen(e,t,n){e.node.addEventListener("paste",(async o=>{var i;const s={id:null===(i=e.content.activeCell)||void 0===i?void 0:i.model.id,index:e.content.widgets.findIndex((t=>t===e.content.activeCell))},l=(o.clipboardData||window.clipboardData).getData("text"),a={eventName:h.id,eventTime:Date.now(),eventInfo:{cells:[s],selection:l}};await t.publishEvent(a,n)}))}}h.id="ClipboardPasteEvent";class m{listen(e,t,n){e.content.activeCellChanged.connect((async(o,i)=>{if(i&&e.content.widgets){const o={id:null==i?void 0:i.model.id,index:e.content.widgets.findIndex((e=>e===i))},s={eventName:m.id,eventTime:Date.now(),eventInfo:{cells:[o]}};await t.publishEvent(s,n)}}))}}m.id="ActiveCellChangeEvent";class p{listen(e,t,n){e.context.saveState.connect((async(e,o)=>{if(o.match("completed")){const e={eventName:p.id,eventTime:Date.now()};await t.publishEvent(e,n)}}))}}p.id="NotebookSaveEvent";class f{listen(e,t,n){o.NotebookActions.executed.connect((async(e,o)=>{const i={id:o.cell.model.id,index:o.notebook.widgets.findIndex((e=>e==o.cell))},s={eventName:f.id,eventTime:Date.now(),eventInfo:{cells:[i],success:o.success,kernelError:o.success?null:o.error}};await t.publishEvent(s,n)}))}}f.id="CellExecuteEvent";class E{listen(e,t,n){var o;null===(o=e.content.model)||void 0===o||o.cells.changed.connect((async(e,o)=>{if("add"===o.type){const e={id:o.newValues[0].id,index:o.newIndex},i={eventName:E.id,eventTime:Date.now(),eventInfo:{cells:[e]}};await t.publishEvent(i,n)}}))}}E.id="CellAddEvent";class y{listen(e,t,n){var o;null===(o=e.content.model)||void 0===o||o.cells.changed.connect((async(e,o)=>{if("remove"===o.type){const e={newIndex:o.newIndex,oldIndex:o.oldIndex},i={eventName:y.id,eventTime:Date.now(),eventInfo:{cells:[e]}};await t.publishEvent(i,n)}}))}}y.id="CellRemoveEvent";const g=[d,v,r,u,w,b,h,m,p,f,E,y],k="jupyterlab-pioneer:plugin",C={id:k,autoStart:!0,requires:[o.INotebookTracker],activate:async(e,t)=>{const n=await l("version");console.log(`${k}: ${n}`);const o=await l("config"),i=new a;t.widgetAdded.connect((async(e,t)=>{await t.sessionContext.ready,await i.loadNotebookPanel(t),g.forEach((e=>{o.activeEvents.includes(e.id)&&(new e).listen(t,i,o.logNotebookContentEvents.includes(e.id))}))}))}}}}]);