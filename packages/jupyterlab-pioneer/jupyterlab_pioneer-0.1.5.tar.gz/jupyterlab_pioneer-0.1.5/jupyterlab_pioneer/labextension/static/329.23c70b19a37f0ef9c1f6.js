"use strict";(self.webpackChunkjupyterlab_pioneer=self.webpackChunkjupyterlab_pioneer||[]).push([[329],{329:(e,t,n)=>{n.r(t),n.d(t,{IJupyterLabPioneer:()=>x,default:()=>I});var o=n(829),i=n(930),s=n(65),l=n(856);async function a(e="",t={}){const n=l.ServerConnection.makeSettings(),o=s.URLExt.join(n.baseUrl,"jupyterlab-pioneer",e);let i;try{i=await l.ServerConnection.makeRequest(o,t,n)}catch(e){throw new l.ServerConnection.NetworkError(e)}let a=await i.text();if(a.length>0)try{a=JSON.parse(a)}catch(e){console.log("Not a JSON response body.",i)}if(!i.ok)throw new l.ServerConnection.ResponseError(i,a.message||a);return a}class d{async loadNotebookPanel(e){this.notebookPanel=e}async publishEvent(e,t){var n,o,i,s,l,d,c;if(!this.notebookPanel)throw Error("router needs to load notebookPanel first.");this.sessionID&&this.sessionID===(null===(o=null===(n=this.notebookPanel)||void 0===n?void 0:n.sessionContext.session)||void 0===o?void 0:o.id)||(this.sessionID=null===(s=null===(i=this.notebookPanel)||void 0===i?void 0:i.sessionContext.session)||void 0===s?void 0:s.id);const r={eventDetail:e,notebookState:{sessionID:this.sessionID,notebookPath:null===(l=this.notebookPanel)||void 0===l?void 0:l.context.path,notebookContent:t?null===(c=null===(d=this.notebookPanel)||void 0===d?void 0:d.model)||void 0===c?void 0:c.toJSON():null}},v=await a("export",{method:"POST",body:JSON.stringify(r)});console.log(v)}}class c{constructor(){this.produced=!1}async listen(e,t,n){if(!this.produced){const e={eventName:c.id,eventTime:Date.now(),eventInfo:{environ:await a("environ")}};await t.router.publishEvent(e,n),this.produced=!0}}}c.id="NotebookOpenEvent";const r=e=>{const t=[];for(let n=0;n<e.content.widgets.length;n++){const o=e.content.widgets[n],i=o.node.offsetTop,s=o.node.offsetTop+o.node.offsetHeight,l=e.content.node.scrollTop;i<=e.content.node.scrollTop+e.content.node.clientHeight&&s>=l&&t.push({id:o.model.id,index:n})}return t};class v{constructor(){this.timeout=0}listen(e,t,n){e.content.node.addEventListener("scroll",(async o=>{o.stopPropagation(),clearTimeout(this.timeout),await new Promise((e=>this.timeout=window.setTimeout(e,1500)));const i={eventName:v.id,eventTime:Date.now(),eventInfo:{cells:r(e)}};await t.router.publishEvent(i,n)}))}}v.id="NotebookScrollEvent";class u{listen(e,t,n){document.addEventListener("visibilitychange",(async()=>{if("visible"===document.visibilityState){const o={eventName:u.id,eventTime:Date.now(),eventInfo:{cells:r(e)}};await t.router.publishEvent(o,n)}}))}}u.id="NotebookVisibleEvent";class w{listen(e,t,n){document.addEventListener("visibilitychange",(async e=>{if("hidden"===document.visibilityState){const e={eventName:w.id,eventTime:Date.now()};await t.router.publishEvent(e,n)}}))}}w.id="NotebookHiddenEvent";class b{listen(e,t,n){e.node.addEventListener("copy",(async()=>{var o,i;const s={id:null===(o=e.content.activeCell)||void 0===o?void 0:o.model.id,index:e.content.widgets.findIndex((t=>t===e.content.activeCell))},l=null===(i=document.getSelection())||void 0===i?void 0:i.toString(),a={eventName:b.id,eventTime:Date.now(),eventInfo:{cells:[s],selection:l}};await t.router.publishEvent(a,n)}))}}b.id="ClipboardCopyEvent";class h{listen(e,t,n){e.node.addEventListener("cut",(async()=>{var o,i;const s={id:null===(o=e.content.activeCell)||void 0===o?void 0:o.model.id,index:e.content.widgets.findIndex((t=>t===e.content.activeCell))},l=null===(i=document.getSelection())||void 0===i?void 0:i.toString(),a={eventName:h.id,eventTime:Date.now(),eventInfo:{cells:[s],selection:l}};await t.router.publishEvent(a,n)}))}}h.id="ClipboardCutEvent";class p{listen(e,t,n){e.node.addEventListener("paste",(async o=>{var i;const s={id:null===(i=e.content.activeCell)||void 0===i?void 0:i.model.id,index:e.content.widgets.findIndex((t=>t===e.content.activeCell))},l=(o.clipboardData||window.clipboardData).getData("text"),a={eventName:p.id,eventTime:Date.now(),eventInfo:{cells:[s],selection:l}};await t.router.publishEvent(a,n)}))}}p.id="ClipboardPasteEvent";class m{listen(e,t,n){e.content.activeCellChanged.connect((async(o,i)=>{if(i&&e.content.widgets){const o={id:null==i?void 0:i.model.id,index:e.content.widgets.findIndex((e=>e===i))},s={eventName:m.id,eventTime:Date.now(),eventInfo:{cells:[o]}};await t.router.publishEvent(s,n)}}))}}m.id="ActiveCellChangeEvent";class f{listen(e,t,n){e.context.saveState.connect((async(e,o)=>{if(o.match("completed")){const e={eventName:f.id,eventTime:Date.now()};await t.router.publishEvent(e,n)}}))}}f.id="NotebookSaveEvent";class E{listen(e,t,n){o.NotebookActions.executed.connect((async(e,o)=>{const i={id:o.cell.model.id,index:o.notebook.widgets.findIndex((e=>e==o.cell))},s={eventName:E.id,eventTime:Date.now(),eventInfo:{cells:[i],success:o.success,kernelError:o.success?null:o.error}};await t.router.publishEvent(s,n)}))}}E.id="CellExecuteEvent";class y{listen(e,t,n){var o;null===(o=e.content.model)||void 0===o||o.cells.changed.connect((async(e,o)=>{if("add"===o.type){const e={id:o.newValues[0].id,index:o.newIndex},i={eventName:y.id,eventTime:Date.now(),eventInfo:{cells:[e]}};await t.router.publishEvent(i,n)}}))}}y.id="CellAddEvent";class g{listen(e,t,n){var o;null===(o=e.content.model)||void 0===o||o.cells.changed.connect((async(e,o)=>{if("remove"===o.type){const e={newIndex:o.newIndex,oldIndex:o.oldIndex},i={eventName:g.id,eventTime:Date.now(),eventInfo:{cells:[e]}};await t.router.publishEvent(i,n)}}))}}g.id="CellRemoveEvent";const k=[c,v,u,w,b,h,p,m,f,E,y,g],C="jupyterlab-pioneer:plugin",x=new i.Token(C);class N{constructor(){this.router=new d}}const I={id:C,autoStart:!0,requires:[o.INotebookTracker],provides:x,activate:async(e,t)=>{const n=await a("version");console.log(`${C}: ${n}`);const o=await a("config"),i=new N;return t.widgetAdded.connect((async(e,t)=>{await t.sessionContext.ready,await i.router.loadNotebookPanel(t),k.forEach((e=>{o.activeEvents.includes(e.id)&&(new e).listen(t,i,o.logNotebookContentEvents.includes(e.id))}))})),i}}}}]);