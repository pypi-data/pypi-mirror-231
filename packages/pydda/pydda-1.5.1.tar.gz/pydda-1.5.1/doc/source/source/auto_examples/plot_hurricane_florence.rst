
.. DO NOT EDIT.
.. THIS FILE WAS AUTOMATICALLY GENERATED BY SPHINX-GALLERY.
.. TO MAKE CHANGES, EDIT THE SOURCE PYTHON FILE:
.. "source/auto_examples/plot_hurricane_florence.py"
.. LINE NUMBERS ARE GIVEN BELOW.

.. only:: html

    .. note::
        :class: sphx-glr-download-link-note

        :ref:`Go to the end <sphx_glr_download_source_auto_examples_plot_hurricane_florence.py>`
        to download the full example code

.. rst-class:: sphx-glr-example-title

.. _sphx_glr_source_auto_examples_plot_hurricane_florence.py:


Example on integrating radar and HRRR data
------------------------------------------

This is an example of how to retrieve winds in Hurricane Florence.
In this example, we use data from 2 NEXRAD radars as well as from
the HRRR to retrieve the winds

This example has been updated to use _Herbie to retrieve the HRRR data.
In addition, _pooch is used to retrieve the gridded data for the example.
Herbie is not required to run PyDDA, but must be installed to run this example.

.. _Herbie: https://herbie.readthedocs.io/en/latest/ 
.. _pooch: https://www.fatiando.org/pooch/latest/index.html
.. image:: ../../hrrr_figure.png

Author: Robert C. Jackson

.. GENERATED FROM PYTHON SOURCE LINES 19-58



.. image-sg:: /source/auto_examples/images/sphx_glr_plot_hurricane_florence_001.png
   :alt:  2018-09-14T06:24:17Z winds at 0.5 km
   :srcset: /source/auto_examples/images/sphx_glr_plot_hurricane_florence_001.png
   :class: sphx-glr-single-img


.. rst-class:: sphx-glr-script-out

 .. code-block:: none

    ✅ Found ┊ model=hrrr ┊ product=prs ┊ 2018-Sep-14 06:00 UTC F00 ┊ GRIB2 @ local ┊ IDX @ aws
    /Users/rjackson/mambaforge/envs/pydda-docs/lib/python3.10/site-packages/pyart/io/cfradial.py:408: UserWarning: WARNING: valid_min not used since it
    cannot be safely cast to variable data type
      data = self.ncvar[:]
    /Users/rjackson/mambaforge/envs/pydda-docs/lib/python3.10/site-packages/pyart/io/cfradial.py:408: UserWarning: WARNING: valid_max not used since it
    cannot be safely cast to variable data type
      data = self.ncvar[:]
    Calculating weights for radars 0 and 1
    Calculating weights for radars 1 and 0
    Calculating weights for models...
    Starting solver 
    rmsVR = 21.58818045293141
    Total points: 1284618
    The max of w_init is 0.0
    Nfeval | Jvel    | Jmass   | Jsmooth |   Jbg   | Jvort   | Jmodel  | Jpoint  | Max w  
          0|12851.7518|   0.0000|   0.0000|   0.0000|   0.0000|2409999.3685|   0.0000|   0.0000
    The gradient of the cost functions is 0.05888562925871848
    Nfeval | Jvel    | Jmass   | Jsmooth |   Jbg   | Jvort   | Jmodel  | Jpoint  | Max w  
         10|1765.2692|  11.1230|   0.0000|   0.0000|   0.0000|  68.7682|   0.0000|   5.7856
    Max change in w: 5.493
    The gradient of the cost functions is 0.02976764185266494
    Nfeval | Jvel    | Jmass   | Jsmooth |   Jbg   | Jvort   | Jmodel  | Jpoint  | Max w  
         20|1746.8479|  23.1931|   0.0000|   0.0000|   0.0000|  67.8785|   0.0000|  12.4929
    Max change in w: 9.565
    The gradient of the cost functions is 0.016704070439358707
    Nfeval | Jvel    | Jmass   | Jsmooth |   Jbg   | Jvort   | Jmodel  | Jpoint  | Max w  
         30|1742.4190|  27.2482|   0.0000|   0.0000|   0.0000|  67.7095|   0.0000|  14.7175
    The gradient of the cost functions is 0.010380907318468472
    Nfeval | Jvel    | Jmass   | Jsmooth |   Jbg   | Jvort   | Jmodel  | Jpoint  | Max w  
         40|1742.3264|  27.2230|   0.0000|   0.0000|   0.0000|  67.5769|   0.0000|  14.7121
    The gradient of the cost functions is 0.010470743148620515
    Nfeval | Jvel    | Jmass   | Jsmooth |   Jbg   | Jvort   | Jmodel  | Jpoint  | Max w  
         50|1742.3273|  27.2220|   0.0000|   0.0000|   0.0000|  67.5771|   0.0000|  14.7113
    The gradient of the cost functions is 0.009557327487034667
    Nfeval | Jvel    | Jmass   | Jsmooth |   Jbg   | Jvort   | Jmodel  | Jpoint  | Max w  
         60|1742.3321|  27.2007|   0.0000|   0.0000|   0.0000|  67.5661|   0.0000|  14.7143
    Max change in w: 1.939
    The gradient of the cost functions is 0.005974823423026537
    Nfeval | Jvel    | Jmass   | Jsmooth |   Jbg   | Jvort   | Jmodel  | Jpoint  | Max w  
         70|1742.4523|  27.0271|   0.0000|   0.0000|   0.0000|  67.5436|   0.0000|  14.9218
    The gradient of the cost functions is 0.005504436607638531
    Nfeval | Jvel    | Jmass   | Jsmooth |   Jbg   | Jvort   | Jmodel  | Jpoint  | Max w  
         80|1742.4125|  26.9418|   0.0000|   0.0000|   0.0000|  67.5416|   0.0000|  14.8454
    The gradient of the cost functions is 0.005679623790438347
    Nfeval | Jvel    | Jmass   | Jsmooth |   Jbg   | Jvort   | Jmodel  | Jpoint  | Max w  
         90|1742.4124|  26.9418|   0.0000|   0.0000|   0.0000|  67.5416|   0.0000|  14.8449
    The gradient of the cost functions is 0.005525978353262874
    Nfeval | Jvel    | Jmass   | Jsmooth |   Jbg   | Jvort   | Jmodel  | Jpoint  | Max w  
        100|1742.4112|  26.9412|   0.0000|   0.0000|   0.0000|  67.5415|   0.0000|  14.8451
    The gradient of the cost functions is 0.004330839724945405
    Nfeval | Jvel    | Jmass   | Jsmooth |   Jbg   | Jvort   | Jmodel  | Jpoint  | Max w  
        110|1742.3963|  26.9358|   0.0000|   0.0000|   0.0000|  67.5551|   0.0000|  14.8494
    The gradient of the cost functions is 0.004285558693705401
    Nfeval | Jvel    | Jmass   | Jsmooth |   Jbg   | Jvort   | Jmodel  | Jpoint  | Max w  
        120|1742.3963|  26.9358|   0.0000|   0.0000|   0.0000|  67.5551|   0.0000|  14.8494
    The gradient of the cost functions is 0.004287003695259103
    Nfeval | Jvel    | Jmass   | Jsmooth |   Jbg   | Jvort   | Jmodel  | Jpoint  | Max w  
        130|1742.3963|  26.9358|   0.0000|   0.0000|   0.0000|  67.5551|   0.0000|  14.8494
    Max change in w: 0.487
    The gradient of the cost functions is 0.0035848950131588627
    Nfeval | Jvel    | Jmass   | Jsmooth |   Jbg   | Jvort   | Jmodel  | Jpoint  | Max w  
        140|1742.3994|  26.9355|   0.0000|   0.0000|   0.0000|  67.5507|   0.0000|  14.8507
    The gradient of the cost functions is 0.002653152521719772
    Nfeval | Jvel    | Jmass   | Jsmooth |   Jbg   | Jvort   | Jmodel  | Jpoint  | Max w  
        150|1742.4005|  26.9357|   0.0000|   0.0000|   0.0000|  67.5497|   0.0000|  14.8515
    The gradient of the cost functions is 0.0030198665089362993
    Nfeval | Jvel    | Jmass   | Jsmooth |   Jbg   | Jvort   | Jmodel  | Jpoint  | Max w  
        160|1742.3999|  26.9356|   0.0000|   0.0000|   0.0000|  67.5502|   0.0000|  14.8510
    The gradient of the cost functions is 0.003014736573403806
    Nfeval | Jvel    | Jmass   | Jsmooth |   Jbg   | Jvort   | Jmodel  | Jpoint  | Max w  
        170|1742.4000|  26.9356|   0.0000|   0.0000|   0.0000|  67.5501|   0.0000|  14.8511
    The gradient of the cost functions is 0.0029748499448354264
    Applying low pass filter to wind field...
    Done! Time = 977.4
    /Users/rjackson/mambaforge/envs/pydda-docs/lib/python3.10/site-packages/cartopy/mpl/geoaxes.py:1604: UserWarning: The following kwargs were not used by contour: 'color'
      result = super().contour(*args, **kwargs)
    /Users/rjackson/mambaforge/envs/pydda-docs/lib/python3.10/site-packages/cartopy/mpl/geoaxes.py:1604: UserWarning: The following kwargs were not used by contour: 'color'
      result = super().contour(*args, **kwargs)






|

.. code-block:: default


    import urllib
    import pyart
    import pydda
    import matplotlib.pyplot as plt
    import cartopy.crs as ccrs
    import numpy as np
    import pooch

    from herbie import Herbie

    H = Herbie("2018-09-14 06:00", model="hrrr", product="prs", fxx=0)
    H.download()

    grid_mhx_path = pydda.tests.get_sample_file("grid_mhx.nc")
    grid_ltx_path = pydda.tests.get_sample_file("grid_ltx.nc")

    grid_mhx = pyart.io.read_grid(grid_mhx_path)
    grid_ltx = pyart.io.read_grid(grid_ltx_path)

    grid_mhx = pydda.constraints.add_hrrr_constraint_to_grid(grid_mhx,
                                                             H.grib)
    grid_mhx = pydda.initialization.make_constant_wind_field(
        grid_mhx, (0.0, 0.0, 0.0))
    out_grids, _ = pydda.retrieval.get_dd_wind_field(
        [grid_mhx, grid_ltx], Co=1e-2, Cm=128.0, Cmod=1e-3, Cx=1e-4, Cy=1e-4, Cz=1e-4,
        max_iterations=100,
        mask_outside_opt=True, vel_name='corrected_velocity', engine="scipy",
        model_fields=["hrrr"])

    fig = plt.figure(figsize=(25, 15))
    ax = plt.axes(projection=ccrs.PlateCarree())
    ax = pydda.vis.plot_horiz_xsection_barbs_map(
        out_grids, ax=ax, bg_grid_no=-1, level=1, barb_spacing_x_km=20.0,
        barb_spacing_y_km=20.0, cmap='pyart_HomeyerRainbow')
    ax.set_xticks(np.arange(-80, -75, 0.5))
    ax.set_yticks(np.arange(33., 35.5, 0.5))
    plt.title(out_grids[0].time['units'][13:] + ' winds at 0.5 km')
    plt.show()


.. rst-class:: sphx-glr-timing

   **Total running time of the script:** (17 minutes 9.349 seconds)


.. _sphx_glr_download_source_auto_examples_plot_hurricane_florence.py:

.. only:: html

  .. container:: sphx-glr-footer sphx-glr-footer-example




    .. container:: sphx-glr-download sphx-glr-download-python

      :download:`Download Python source code: plot_hurricane_florence.py <plot_hurricane_florence.py>`

    .. container:: sphx-glr-download sphx-glr-download-jupyter

      :download:`Download Jupyter notebook: plot_hurricane_florence.ipynb <plot_hurricane_florence.ipynb>`


.. only:: html

 .. rst-class:: sphx-glr-signature

    `Gallery generated by Sphinx-Gallery <https://sphinx-gallery.github.io>`_
