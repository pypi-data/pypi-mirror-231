import{r as f,n as le,D as K,y as V,o as Pe,p as R,R as ce,q as Re,s as he,t as Q,X as G,I as X,v as ve,w as Se,x as je,z as q,A as Ne,T as Ce,B as I,F as De,G as Y,H as ke,J as ue,K as ge,P as Me,u as ye,Q as F,a as E,U as Ae,V as D,e as T,W as P,Y as _,Z as Fe,j as t,d as N,$ as U,a0 as B,c as A,S as be,a1 as Te,a2 as Ie,a3 as de,a4 as J,a5 as $e,a6 as Le,E as ze}from"./index-7b671d2d.js";import{C as Oe,I as me}from"./Input-d1a3d8af.js";import{E as M}from"./context-10ffe9cf.js";import{F as _e,P as fe}from"./PlanChangePreview-bae5f833.js";import{b as Be,u as Qe,a as C,x as Ue}from"./context-b40758d6.js";import{s as Ke,k as pe}from"./popover-e41d7b42.js";import{M as Ve}from"./disclosure-6db3cf47.js";import"./ModelLineage-20667b0b.js";import"./PlusIcon-b15cc489.js";import"./_commonjs-dynamic-modules-302442b1.js";function Ge({title:e,titleId:a,...i},n){return f.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"currentColor","aria-hidden":"true",ref:n,"aria-labelledby":a},i),e?f.createElement("title",{id:a},e):null,f.createElement("path",{fillRule:"evenodd",d:"M2.25 12c0-5.385 4.365-9.75 9.75-9.75s9.75 4.365 9.75 9.75-4.365 9.75-9.75 9.75S2.25 17.385 2.25 12zm13.36-1.814a.75.75 0 10-1.22-.872l-3.236 4.53L9.53 12.22a.75.75 0 00-1.06 1.06l2.25 2.25a.75.75 0 001.14-.094l3.75-5.25z",clipRule:"evenodd"}))}const He=f.forwardRef(Ge),qe=He;var Je=(e=>(e[e.Open=0]="Open",e[e.Closed=1]="Closed",e))(Je||{}),We=(e=>(e[e.Pointer=0]="Pointer",e[e.Other=1]="Other",e))(We||{}),Ye=(e=>(e[e.OpenMenu=0]="OpenMenu",e[e.CloseMenu=1]="CloseMenu",e[e.GoToItem=2]="GoToItem",e[e.Search=3]="Search",e[e.ClearSearch=4]="ClearSearch",e[e.RegisterItem=5]="RegisterItem",e[e.UnregisterItem=6]="UnregisterItem",e))(Ye||{});function W(e,a=i=>i){let i=e.activeItemIndex!==null?e.items[e.activeItemIndex]:null,n=Me(a(e.items.slice()),d=>d.dataRef.current.domRef.current),l=i?n.indexOf(i):null;return l===-1&&(l=null),{items:n,activeItemIndex:l}}let Xe={1(e){return e.menuState===1?e:{...e,activeItemIndex:null,menuState:1}},0(e){return e.menuState===0?e:{...e,__demoMode:!1,menuState:0}},2:(e,a)=>{var i;let n=W(e),l=Ue(a,{resolveItems:()=>n.items,resolveActiveIndex:()=>n.activeItemIndex,resolveId:d=>d.id,resolveDisabled:d=>d.dataRef.current.disabled});return{...e,...n,searchQuery:"",activeItemIndex:l,activationTrigger:(i=a.trigger)!=null?i:1}},3:(e,a)=>{let i=e.searchQuery!==""?0:1,n=e.searchQuery+a.value.toLowerCase(),l=(e.activeItemIndex!==null?e.items.slice(e.activeItemIndex+i).concat(e.items.slice(0,e.activeItemIndex+i)):e.items).find(c=>{var s;return((s=c.dataRef.current.textValue)==null?void 0:s.startsWith(n))&&!c.dataRef.current.disabled}),d=l?e.items.indexOf(l):-1;return d===-1||d===e.activeItemIndex?{...e,searchQuery:n}:{...e,searchQuery:n,activeItemIndex:d,activationTrigger:1}},4(e){return e.searchQuery===""?e:{...e,searchQuery:"",searchActiveItemIndex:null}},5:(e,a)=>{let i=W(e,n=>[...n,{id:a.id,dataRef:a.dataRef}]);return{...e,...i}},6:(e,a)=>{let i=W(e,n=>{let l=n.findIndex(d=>d.id===a.id);return l!==-1&&n.splice(l,1),n});return{...e,...i,activationTrigger:1}}},Z=f.createContext(null);Z.displayName="MenuContext";function H(e){let a=f.useContext(Z);if(a===null){let i=new Error(`<${e} /> is missing a parent <Menu /> component.`);throw Error.captureStackTrace&&Error.captureStackTrace(i,H),i}return a}function Ze(e,a){return he(a.type,Xe,e,a)}let et=f.Fragment;function tt(e,a){let{__demoMode:i=!1,...n}=e,l=f.useReducer(Ze,{__demoMode:i,menuState:i?0:1,buttonRef:f.createRef(),itemsRef:f.createRef(),items:[],searchQuery:"",activeItemIndex:null,activationTrigger:1}),[{menuState:d,itemsRef:c,buttonRef:s},r]=l,h=V(a);Pe([s,c],(w,S)=>{var u;r({type:1}),Ne(S,Ce.Loose)||(w.preventDefault(),(u=s.current)==null||u.focus())},d===0);let y=R(()=>{r({type:1})}),x=f.useMemo(()=>({open:d===0,close:y}),[d,y]),v={ref:h};return ce.createElement(Z.Provider,{value:l},ce.createElement(Re,{value:he(d,{0:Q.Open,1:Q.Closed})},G({ourProps:v,theirProps:n,slot:x,defaultTag:et,name:"Menu"})))}let nt="button";function at(e,a){var i;let n=X(),{id:l=`headlessui-menu-button-${n}`,...d}=e,[c,s]=H("Menu.Button"),r=V(c.buttonRef,a),h=ve(),y=R(u=>{switch(u.key){case I.Space:case I.Enter:case I.ArrowDown:u.preventDefault(),u.stopPropagation(),s({type:0}),h.nextFrame(()=>s({type:2,focus:C.First}));break;case I.ArrowUp:u.preventDefault(),u.stopPropagation(),s({type:0}),h.nextFrame(()=>s({type:2,focus:C.Last}));break}}),x=R(u=>{switch(u.key){case I.Space:u.preventDefault();break}}),v=R(u=>{if(De(u.currentTarget))return u.preventDefault();e.disabled||(c.menuState===0?(s({type:1}),h.nextFrame(()=>{var m;return(m=c.buttonRef.current)==null?void 0:m.focus({preventScroll:!0})})):(u.preventDefault(),s({type:0})))}),w=f.useMemo(()=>({open:c.menuState===0}),[c]),S={ref:r,id:l,type:Ke(e,c.buttonRef),"aria-haspopup":"menu","aria-controls":(i=c.itemsRef.current)==null?void 0:i.id,"aria-expanded":c.menuState===0,onKeyDown:y,onKeyUp:x,onClick:v};return G({ourProps:S,theirProps:d,slot:w,defaultTag:nt,name:"Menu.Button"})}let st="div",rt=le.RenderStrategy|le.Static;function it(e,a){var i,n;let l=X(),{id:d=`headlessui-menu-items-${l}`,...c}=e,[s,r]=H("Menu.Items"),h=V(s.itemsRef,a),y=Se(s.itemsRef),x=ve(),v=je(),w=(()=>v!==null?(v&Q.Open)===Q.Open:s.menuState===0)();f.useEffect(()=>{let o=s.itemsRef.current;o&&s.menuState===0&&o!==(y==null?void 0:y.activeElement)&&o.focus({preventScroll:!0})},[s.menuState,s.itemsRef,y]),_e({container:s.itemsRef.current,enabled:s.menuState===0,accept(o){return o.getAttribute("role")==="menuitem"?NodeFilter.FILTER_REJECT:o.hasAttribute("role")?NodeFilter.FILTER_SKIP:NodeFilter.FILTER_ACCEPT},walk(o){o.setAttribute("role","none")}});let S=R(o=>{var b,k;switch(x.dispose(),o.key){case I.Space:if(s.searchQuery!=="")return o.preventDefault(),o.stopPropagation(),r({type:3,value:o.key});case I.Enter:if(o.preventDefault(),o.stopPropagation(),r({type:1}),s.activeItemIndex!==null){let{dataRef:g}=s.items[s.activeItemIndex];(k=(b=g.current)==null?void 0:b.domRef.current)==null||k.click()}ge(s.buttonRef.current);break;case I.ArrowDown:return o.preventDefault(),o.stopPropagation(),r({type:2,focus:C.Next});case I.ArrowUp:return o.preventDefault(),o.stopPropagation(),r({type:2,focus:C.Previous});case I.Home:case I.PageUp:return o.preventDefault(),o.stopPropagation(),r({type:2,focus:C.First});case I.End:case I.PageDown:return o.preventDefault(),o.stopPropagation(),r({type:2,focus:C.Last});case I.Escape:o.preventDefault(),o.stopPropagation(),r({type:1}),Y().nextFrame(()=>{var g;return(g=s.buttonRef.current)==null?void 0:g.focus({preventScroll:!0})});break;case I.Tab:o.preventDefault(),o.stopPropagation(),r({type:1}),Y().nextFrame(()=>{ke(s.buttonRef.current,o.shiftKey?ue.Previous:ue.Next)});break;default:o.key.length===1&&(r({type:3,value:o.key}),x.setTimeout(()=>r({type:4}),350));break}}),u=R(o=>{switch(o.key){case I.Space:o.preventDefault();break}}),m=f.useMemo(()=>({open:s.menuState===0}),[s]),j={"aria-activedescendant":s.activeItemIndex===null||(i=s.items[s.activeItemIndex])==null?void 0:i.id,"aria-labelledby":(n=s.buttonRef.current)==null?void 0:n.id,id:d,onKeyDown:S,onKeyUp:u,role:"menu",tabIndex:0,ref:h};return G({ourProps:j,theirProps:c,slot:m,defaultTag:st,features:rt,visible:w,name:"Menu.Items"})}let ot=f.Fragment;function lt(e,a){let i=X(),{id:n=`headlessui-menu-item-${i}`,disabled:l=!1,...d}=e,[c,s]=H("Menu.Item"),r=c.activeItemIndex!==null?c.items[c.activeItemIndex].id===n:!1,h=f.useRef(null),y=V(a,h);q(()=>{if(c.__demoMode||c.menuState!==0||!r||c.activationTrigger===0)return;let g=Y();return g.requestAnimationFrame(()=>{var $,L;(L=($=h.current)==null?void 0:$.scrollIntoView)==null||L.call($,{block:"nearest"})}),g.dispose},[c.__demoMode,h,r,c.menuState,c.activationTrigger,c.activeItemIndex]);let x=Be(h),v=f.useRef({disabled:l,domRef:h,get textValue(){return x()}});q(()=>{v.current.disabled=l},[v,l]),q(()=>(s({type:5,id:n,dataRef:v}),()=>s({type:6,id:n})),[v,n]);let w=R(()=>{s({type:1})}),S=R(g=>{if(l)return g.preventDefault();s({type:1}),ge(c.buttonRef.current)}),u=R(()=>{if(l)return s({type:2,focus:C.Nothing});s({type:2,focus:C.Specific,id:n})}),m=Qe(),j=R(g=>m.update(g)),o=R(g=>{m.wasMoved(g)&&(l||r||s({type:2,focus:C.Specific,id:n,trigger:0}))}),b=R(g=>{m.wasMoved(g)&&(l||r&&s({type:2,focus:C.Nothing}))}),k=f.useMemo(()=>({active:r,disabled:l,close:w}),[r,l,w]);return G({ourProps:{id:n,ref:y,role:"menuitem",tabIndex:l===!0?void 0:-1,"aria-disabled":l===!0?!0:void 0,disabled:void 0,onClick:S,onFocus:u,onPointerEnter:j,onMouseEnter:j,onPointerMove:o,onMouseMove:o,onPointerLeave:b,onMouseLeave:b},theirProps:d,slot:k,defaultTag:ot,name:"Menu.Item"})}let ct=K(tt),ut=K(at),dt=K(it),mt=K(lt),z=Object.assign(ct,{Button:ut,Items:dt,Item:mt});function Rt(){const{setIsPlanOpen:e}=ye(),a=F(p=>p.state),i=F(p=>p.action),n=F(p=>p.setState),l=F(p=>p.setAction),d=F(p=>p.setActivePlan),c=E(p=>p.addConfirmation),s=E(p=>p.setShowConfirmation),r=E(p=>p.environment),h=E(p=>p.environments),y=E(p=>p.setInitialDates),x=E(p=>p.hasSynchronizedEnvironments),[v,w]=f.useState(!1),[S,u]=f.useState(),[m,j]=f.useState(!1),{refetch:o,data:b,isFetching:k}=Ae(r.name,{planOptions:{skip_tests:!0,include_unmodified:!0}});f.useEffect(()=>{m&&(g(),j(!1)),!D(r.isSynchronized)&&o()},[r]),f.useEffect(()=>{var p,te,ne,ae,se,re,ie,oe;b!=null&&(u(b),y(b.start,b.end),w([(p=b.changes)==null?void 0:p.added,(te=b.changes)==null?void 0:te.removed,(ae=(ne=b.changes)==null?void 0:ne.modified)==null?void 0:ae.direct,(re=(se=b.changes)==null?void 0:se.modified)==null?void 0:re.indirect,(oe=(ie=b.changes)==null?void 0:ie.modified)==null?void 0:oe.metadata].some(T)))},[b]);function g(){d(void 0),n(P.Init),l(_.Run),e(!0)}const L=(D(r.isDefault)||x())&&(D(r.isDefault)||D(r.isInitial)),we=Fe([P.Applying,P.Running,P.Cancelling],a),ee=k||i!==_.None||a===P.Applying||a===P.Running||a===P.Cancelling;return t.jsxs("div",{className:N("flex items-center",r==null&&"opacity-50 pointer-events-none cursor-not-allowed"),children:[t.jsxs("div",{className:"flex items-center relative",children:[t.jsxs(U,{className:N("mx-0",D(r.isInitial&&r.isDefault)&&"rounded-none rounded-l-lg border-r"),disabled:ee,variant:B.Alternative,size:A.sm,onClick:p=>{p.stopPropagation(),r.isDefault&&D(r.isInitial)?c({headline:"Running Plan Directly On Prod Environment!",description:"Are you sure you want to run your changes directly on prod? Safer choice will be to select or add new environment first.",yesText:`Yes, Run ${r.name}`,noText:"No, Cancel",action(){g()},children:t.jsxs("div",{className:"mt-5 pt-4",children:[t.jsx("h4",{className:"mb-2",children:`${h.size>1?"Select or ":""}Add Environment`}),t.jsxs("div",{className:"flex items-center relative",children:[h.size>1&&t.jsx(xe,{className:"mr-2",side:"left",environment:r,showAddEnvironment:!1,onSelect:()=>{j(!0),s(!1)},size:A.md,disabled:k||i!==_.None||a===P.Applying||a===P.Cancelling}),t.jsx(Ee,{className:"w-full",size:A.md,onAdd:()=>{j(!0),s(!1)}})]})]})}):g()},children:[we&&t.jsx(be,{className:"w-3 h-3 mr-1"}),t.jsx("span",{className:"inline-block",children:pt(a,i)})]}),L&&t.jsx(xe,{className:"rounded-none rounded-r-lg border-l mx-0",environment:r,disabled:ee})]}),t.jsx(ft,{environment:r,plan:S,isLoading:k,hasChanges:v})]})}function ft({isLoading:e,hasChanges:a,environment:i,plan:n}){var l,d,c,s;return t.jsx("span",{className:"flex align-center h-full w-full",children:t.jsx(t.Fragment,{children:e?t.jsxs("span",{className:"flex items-center ml-2",children:[t.jsx(be,{className:"w-3 h-3 mr-1"}),t.jsx("span",{className:"inline-block text-xs text-neutral-500",children:"Checking..."})]}):t.jsxs(t.Fragment,{children:[i.isInitial&&i.isLocal&&t.jsx("span",{title:"New",className:"block ml-1 px-2 first-child:ml-0 rounded-full bg-success-10 text-success-500 text-xs text-center font-bold",children:"New"}),[a,e,i.isLocal].every(D)&&t.jsx("span",{title:"Latest",className:"block ml-1 px-2 first-child:ml-0 rounded-full bg-neutral-10 text-xs text-center",children:t.jsx("span",{children:"Latest"})}),T((l=n==null?void 0:n.changes)==null?void 0:l.added)&&t.jsx(O,{headline:"Added Models",type:M.Add,changes:n.changes.added}),T((d=n==null?void 0:n.changes)==null?void 0:d.modified.direct)&&t.jsx(O,{headline:"Direct Changes",type:M.Direct,changes:n.changes.modified.direct.map(({model_name:r})=>r)}),T((c=n==null?void 0:n.changes)==null?void 0:c.modified.indirect)&&t.jsx(O,{headline:"Indirectly Modified",type:M.Indirect,changes:n.changes.modified.indirect.map(r=>r.model_name)}),T((s=n==null?void 0:n.changes)==null?void 0:s.removed)&&t.jsx(O,{headline:"Removed Models",type:M.Remove,changes:n.changes.removed})]})})})}function xe({onSelect:e,environment:a,disabled:i,side:n=J.Right,className:l,showAddEnvironment:d=!0,size:c=A.sm}){const{addError:s}=ye(),r=E(u=>u.environments),h=E(u=>u.pinnedEnvironments),y=E(u=>u.defaultEnvironment),x=E(u=>u.setEnvironment),v=E(u=>u.removeLocalEnvironment),w=Te(z.Button);function S(u){Le(u.name).then(()=>{v(u)}).catch(m=>{s(ze.Environments,m)})}return t.jsx(z,{children:({close:u})=>t.jsxs(t.Fragment,{children:[t.jsxs(w,{variant:B.Alternative,size:c,disabled:i,className:N(l),children:[t.jsx("span",{className:N("block overflow-hidden truncate",(a.isLocal||i)&&"text-neutral-500",a.isSynchronized&&"text-primary-500"),children:a.name}),t.jsx("span",{className:"pointer-events-none inset-y-0 right-0 flex items-center pl-2",children:t.jsx(Oe,{className:"h-4 w-4","aria-hidden":"true"})})]}),t.jsx(Ie,{as:f.Fragment,leave:"transition ease-in duration-100",leaveFrom:"opacity-100",leaveTo:"opacity-0",children:t.jsxs("div",{className:N("absolute top-9 overflow-hidden shadow-xl bg-theme border-2 border-primary-20 rounded-md flex flex-col z-10",n===J.Left&&"left-0",n===J.Right&&"right-0"),children:[t.jsxs(z.Items,{className:"overflow-auto max-h-80 py-2 hover:scrollbar scrollbar--vertical",children:[Array.from(r).map(m=>t.jsx(z.Item,{children:({active:j})=>t.jsxs("div",{onClick:o=>{o.stopPropagation(),x(m),e==null||e()},className:N("flex justify-between items-center pl-2 pr-1 py-1 cursor-pointer overflow-auto",j&&"bg-primary-10",m===a&&"pointer-events-none cursor-default bg-secondary-10"),children:[t.jsxs("div",{className:"flex items-start",children:[t.jsx(qe,{className:N("w-4 h-4 text-primary-500 mt-1.5",j&&"opacity-10",m!==a&&"opacity-0")}),t.jsxs("span",{className:"block",children:[t.jsxs("span",{className:"flex items-center",children:[t.jsx("span",{className:N("block truncate ml-2",m.isSynchronized&&"text-primary-500"),children:m.name}),t.jsxs("small",{className:"block ml-2",children:["(",m.type,")"]})]}),m.isDefault&&t.jsx("span",{className:"flex ml-2",children:t.jsx("small",{className:"text-xs text-neutral-500",children:"Main Environment"})}),y===m&&t.jsx("span",{className:"flex ml-2",children:t.jsx("small",{className:"text-xs text-neutral-500",children:"Default Environment"})})]})]}),m.isLocal&&m!==a&&t.jsx(U,{className:"!m-0 !px-2 bg-transparent hover:bg-transparent border-none",size:A.xs,variant:B.Neutral,onClick:o=>{o.stopPropagation(),v(m)},children:t.jsx(Ve,{className:"w-4 text-neutral-500 dark:text-neutral-100"})}),D(m.isDefault)&&m!==a&&m.isSynchronized&&D(h.includes(m))&&t.jsx(U,{className:"!px-2 !my-0",size:A.xs,variant:B.Danger,onClick:o=>{o.stopPropagation(),S(m)},children:"Delete"})]})},m.name)),d&&t.jsxs(t.Fragment,{children:[t.jsx(de,{}),t.jsx(Ee,{onAdd:u,className:"mt-2 px-2"})]})]}),t.jsx(de,{})]})})]})})}function Ee({onAdd:e,className:a,label:i="Add",size:n=A.sm}){const l=E(x=>x.getNextEnvironment),d=E(x=>x.isExistingEnvironment),c=E(x=>x.addLocalEnvironment),[s,r]=f.useState(""),[h,y]=f.useState(l().name);return t.jsxs("div",{className:N("flex w-full items-center",a),children:[t.jsx(me,{className:"my-0 mx-0 mr-4 min-w-[10rem] w-full",size:n,children:({className:x})=>t.jsx(me.Textfield,{className:N(x,"w-full"),placeholder:"Environment",value:s,onInput:v=>{v.stopPropagation(),r(v.target.value)}})}),t.jsx(U,{className:"my-0 mx-0 font-bold",size:n,disabled:$e(s)||d(s),onClick:x=>{x.stopPropagation(),c(s,h),r(""),y(l().name),e==null||e()},children:i})]})}function O({headline:e,type:a,changes:i}){const[n,l]=f.useState(!1);return t.jsx(pe,{onMouseEnter:()=>{l(!0)},onMouseLeave:()=>{l(!1)},className:"relative flex",children:()=>t.jsxs(t.Fragment,{children:[t.jsx("span",{className:N("inline-block ml-1 px-2 rounded-full text-xs font-bold text-neutral-100 cursor-default border border-inherit",a===M.Add&&"bg-success-500 border-success-500",a===M.Remove&&"bg-danger-500 border-danger-500",a===M.Direct&&"bg-secondary-500 border-secondary-500",a===M.Indirect&&"bg-warning-500 border-warning-500",a==="metadata"&&"bg-neutral-500 border-neutral-500"),children:i.length}),t.jsx(Ie,{show:n,as:f.Fragment,enter:"transition ease-out duration-200",enterFrom:"opacity-0 translate-y-1",enterTo:"opacity-100 translate-y-0",leave:"transition ease-in duration-150",leaveFrom:"opacity-100 translate-y-0",leaveTo:"opacity-0 translate-y-1",children:t.jsx(pe.Panel,{className:"absolute right-1 z-10 mt-8 transform flex p-2 bg-theme-lighter shadow-xl focus:ring-2 ring-opacity-5 rounded-lg ",children:t.jsx(fe,{headline:e,type:a,className:"w-full h-full max-w-[50vw] max-h-[40vh] overflow-hidden overflow-y-auto ",children:t.jsx(fe.Default,{type:a,changes:i})})})})]})})}function pt(e,a){return e===P.Running?"Running Plan...":e===P.Applying?"Applying Plan...":e===P.Cancelling?"Cancelling Plan...":a===_.None?"Run Plan":"Setting Plan..."}export{Rt as default};
