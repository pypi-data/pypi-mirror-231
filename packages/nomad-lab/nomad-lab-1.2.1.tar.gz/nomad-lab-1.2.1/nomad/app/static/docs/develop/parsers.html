
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
        <meta name="description" content="The documentation for NOMAD v1.
">
      
      
        <meta name="author" content="The NOMAD Authors">
      
      
      <link rel="icon" href="../assets/favicon.png">
      <meta name="generator" content="mkdocs-1.2.3, mkdocs-material-8.1.1">
    
    
      
        <title>How to write a parser - Documentation</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/main.23b6d78a.min.css">
      
        
        <link rel="stylesheet" href="../assets/stylesheets/palette.e6a45f82.min.css">
        
          
          
          <meta name="theme-color" content="">
        
      
    
    
    
      
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Titillium+Web:300,400,400i,700%7C&display=fallback">
        <style>:root{--md-text-font:"Titillium Web";--md-code-font:""}</style>
      
    
    
      <link rel="stylesheet" href="../stylesheets/extra.css">
    
    <script>__md_scope=new URL("..",location),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
  </head>
  
  
    
    
    
    
    
    <body dir="ltr" data-md-color-scheme="" data-md-color-primary="#2a4cdf" data-md-color-accent="#008a67">
  
    
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#how-to-write-a-parser" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="https://nomad-lab.eu" title="Documentation" class="md-header__button md-logo" aria-label="Documentation" data-md-component="logo">
      
  <img src="../assets/nomad-logo.png" alt="logo">

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Documentation
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              How to write a parser
            
          </span>
        </div>
      </div>
    </div>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" aria-label="Clear" tabindex="-1">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="https://nomad-lab.eu" title="Documentation" class="md-nav__button md-logo" aria-label="Documentation" data-md-component="logo">
      
  <img src="../assets/nomad-logo.png" alt="logo">

    </a>
    Documentation
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../index.html" class="md-nav__link">
        Home
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../tutorial.html" class="md-nav__link">
        Tutorial
      </a>
    </li>
  

    
      
      
      

  
  
    
  
  
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_3" type="checkbox" id="__nav_3" checked>
      
      
      
      
        <label class="md-nav__link" for="__nav_3">
          How-to guides
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="How-to guides" data-md-level="1">
        <label class="md-nav__title" for="__nav_3">
          <span class="md-nav__icon md-icon"></span>
          How-to guides
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_3_1" type="checkbox" id="__nav_3_1" >
      
      
      
      
        <label class="md-nav__link" for="__nav_3_1">
          Data Management
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Data Management" data-md-level="2">
        <label class="md-nav__title" for="__nav_3_1">
          <span class="md-nav__icon md-icon"></span>
          Data Management
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../data/upload.html" class="md-nav__link">
        How to upload/publish data
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../data/eln.html" class="md-nav__link">
        How to use ELNs
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../data/explore.html" class="md-nav__link">
        How to explore data
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../data/north.html" class="md-nav__link">
        How to use NORTH
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_3_2" type="checkbox" id="__nav_3_2" >
      
      
      
      
        <label class="md-nav__link" for="__nav_3_2">
          Schemas
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Schemas" data-md-level="2">
        <label class="md-nav__title" for="__nav_3_2">
          <span class="md-nav__icon md-icon"></span>
          Schemas
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../schemas/basics.html" class="md-nav__link">
        How to write a schema
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../schemas/elns.html" class="md-nav__link">
        How to define ELNs
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../schemas/base_sections.html" class="md-nav__link">
        How to use base sections
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../schemas/tabular.html" class="md-nav__link">
        How to define tabular data
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../schemas/workflows.html" class="md-nav__link">
        How to define workflows
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../schemas/hdf5.html" class="md-nav__link">
        How to reference hdf5
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_3_3" type="checkbox" id="__nav_3_3" >
      
      
      
      
        <label class="md-nav__link" for="__nav_3_3">
          Programming interfaces
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Programming interfaces" data-md-level="2">
        <label class="md-nav__title" for="__nav_3_3">
          <span class="md-nav__icon md-icon"></span>
          Programming interfaces
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../apis/api.html" class="md-nav__link">
        How to use the API
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../apis/pythonlib.html" class="md-nav__link">
        How to install nomad-lab
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../apis/archive_query.html" class="md-nav__link">
        How to access processed data
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../apis/local_parsers.html" class="md-nav__link">
        How to run a parser
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_3_4" type="checkbox" id="__nav_3_4" >
      
      
      
      
        <label class="md-nav__link" for="__nav_3_4">
          Plugins
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Plugins" data-md-level="2">
        <label class="md-nav__title" for="__nav_3_4">
          <span class="md-nav__icon md-icon"></span>
          Plugins
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../plugins/plugins.html" class="md-nav__link">
        How to develop, publish, and install plugins
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../plugins/schemas.html" class="md-nav__link">
        How to write schema plugins
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../plugins/parsers.html" class="md-nav__link">
        How to write parser plugins
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
    
  
  
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_3_5" type="checkbox" id="__nav_3_5" checked>
      
      
      
      
        <label class="md-nav__link" for="__nav_3_5">
          Development
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Development" data-md-level="2">
        <label class="md-nav__title" for="__nav_3_5">
          <span class="md-nav__icon md-icon"></span>
          Development
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="setup.html" class="md-nav__link">
        How to get started
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="code.html" class="md-nav__link">
        How to navigate the code
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="contrib.html" class="md-nav__link">
        How to contribute
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="guides.html" class="md-nav__link">
        Code guidelines
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="search.html" class="md-nav__link">
        How to extend the search
      </a>
    </li>
  

            
          
            
              
  
  
    
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" data-md-toggle="toc" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          How to write a parser
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="parsers.html" class="md-nav__link md-nav__link--active">
        How to write a parser
      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#getting-started" class="md-nav__link">
    Getting started
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#parsing-test-files" class="md-nav__link">
    Parsing test files
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#extending-the-metainfo" class="md-nav__link">
    Extending the Metainfo
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#testing-a-parser" class="md-nav__link">
    Testing a parser
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#structured-data-files-with-numpsy" class="md-nav__link">
    Structured data files with NumPsy
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#xml-parser" class="md-nav__link">
    XML Parser
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#add-the-parser-to-nomad" class="md-nav__link">
    Add the parser to NOMAD
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#developing-an-existing-parser" class="md-nav__link">
    Developing an existing parser
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="normalizers.html" class="md-nav__link">
        How to write a normalizer
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_3_6" type="checkbox" id="__nav_3_6" >
      
      
      
      
        <label class="md-nav__link" for="__nav_3_6">
          Oasis
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Oasis" data-md-level="2">
        <label class="md-nav__title" for="__nav_3_6">
          <span class="md-nav__icon md-icon"></span>
          Oasis
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../oasis/install.html" class="md-nav__link">
        How to install an Oasis
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../oasis/customize.html" class="md-nav__link">
        How to customize an Oasis
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../oasis/migrate.html" class="md-nav__link">
        How to migrate Oasis versions
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../oasis/admin.html" class="md-nav__link">
        Administrative tasks
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_4" type="checkbox" id="__nav_4" >
      
      
      
      
        <label class="md-nav__link" for="__nav_4">
          Learn
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Learn" data-md-level="1">
        <label class="md-nav__title" for="__nav_4">
          <span class="md-nav__icon md-icon"></span>
          Learn
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../learn/basics.html" class="md-nav__link">
        From files to data
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../learn/data.html" class="md-nav__link">
        Structured data
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../learn/architecture.html" class="md-nav__link">
        Architecture
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../learn/oasis.html" class="md-nav__link">
        Why you need an Oasis
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_5" type="checkbox" id="__nav_5" >
      
      
      
      
        <label class="md-nav__link" for="__nav_5">
          Reference
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Reference" data-md-level="1">
        <label class="md-nav__title" for="__nav_5">
          <span class="md-nav__icon md-icon"></span>
          Reference
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../reference/config.html" class="md-nav__link">
        Configuration
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../reference/annotations.html" class="md-nav__link">
        Schema annotations
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../reference/cli.html" class="md-nav__link">
        Command Line Interface (CLI)
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../reference/plugins.html" class="md-nav__link">
        Built-in plugins
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../reference/parsers.html" class="md-nav__link">
        Supported parsers
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../reference/glossary.html" class="md-nav__link">
        Glossary
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#getting-started" class="md-nav__link">
    Getting started
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#parsing-test-files" class="md-nav__link">
    Parsing test files
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#extending-the-metainfo" class="md-nav__link">
    Extending the Metainfo
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#testing-a-parser" class="md-nav__link">
    Testing a parser
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#structured-data-files-with-numpsy" class="md-nav__link">
    Structured data files with NumPsy
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#xml-parser" class="md-nav__link">
    XML Parser
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#add-the-parser-to-nomad" class="md-nav__link">
    Add the parser to NOMAD
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#developing-an-existing-parser" class="md-nav__link">
    Developing an existing parser
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content" data-md-component="content">
            <article class="md-content__inner md-typeset">
              
                

<h1 id="how-to-write-a-parser">How to write a parser<a class="headerlink" href="#how-to-write-a-parser" title="Permanent link">&para;</a></h1>
<p>NOMAD uses parsers to convert raw code input and output files into NOMAD's common archive
format. This is the documentation on how to develop such a parser.</p>
<h2 id="getting-started">Getting started<a class="headerlink" href="#getting-started" title="Permanent link">&para;</a></h2>
<p>Let's assume we need to write a new parser from scratch.</p>
<p>First we need to install the <code>nomad-lab</code> Python package to get the necessary libraries:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a>pip<span class="w"> </span>install<span class="w"> </span>nomad-lab
</code></pre></div>
<p>We have prepared an example parser project that you can work with:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-1-1" name="__codelineno-1-1" href="#__codelineno-1-1"></a>git<span class="w"> </span>clone<span class="w"> </span>https://github.com/nomad-coe/nomad-parser-example.git<span class="w"> </span>--branch<span class="w"> </span>hello-world
</code></pre></div>
<p>Alternatively, you can fork the example project on GitHub to create your own parser. Clone
your fork accordingly.</p>
<p>The project structure should be:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-2-1" name="__codelineno-2-1" href="#__codelineno-2-1"></a>example/exampleparser/__init__.py
<a id="__codelineno-2-2" name="__codelineno-2-2" href="#__codelineno-2-2"></a>example/exampleparser/__main__.py
<a id="__codelineno-2-3" name="__codelineno-2-3" href="#__codelineno-2-3"></a>example/exampleparser/metainfo.py
<a id="__codelineno-2-4" name="__codelineno-2-4" href="#__codelineno-2-4"></a>example/exampleparser/parser.py
<a id="__codelineno-2-5" name="__codelineno-2-5" href="#__codelineno-2-5"></a>example/LICENSE.txt
<a id="__codelineno-2-6" name="__codelineno-2-6" href="#__codelineno-2-6"></a>example/README.md
<a id="__codelineno-2-7" name="__codelineno-2-7" href="#__codelineno-2-7"></a>example/setup.py
</code></pre></div>
<p>Next, you should install your new parser with pip. The <code>-e</code> parameter installs the parser
in <em>development</em>. This means you can change the sources without having to reinstall:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-3-1" name="__codelineno-3-1" href="#__codelineno-3-1"></a><span class="nb">cd</span><span class="w"> </span>example
<a id="__codelineno-3-2" name="__codelineno-3-2" href="#__codelineno-3-2"></a>pip<span class="w"> </span>install<span class="w"> </span>-e<span class="w"> </span>.
</code></pre></div>
<p>The main code file <code>exampleparser/parser.py</code> should look like this:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-4-1" name="__codelineno-4-1" href="#__codelineno-4-1"></a><span class="k">class</span> <span class="nc">ExampleParser</span><span class="p">(</span><span class="n">MatchingParser</span><span class="p">):</span>
<a id="__codelineno-4-2" name="__codelineno-4-2" href="#__codelineno-4-2"></a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<a id="__codelineno-4-3" name="__codelineno-4-3" href="#__codelineno-4-3"></a>        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;parsers/example&#39;</span><span class="p">,</span> <span class="n">code_name</span><span class="o">=</span><span class="s1">&#39;EXAMPLE&#39;</span><span class="p">)</span>
<a id="__codelineno-4-4" name="__codelineno-4-4" href="#__codelineno-4-4"></a>
<a id="__codelineno-4-5" name="__codelineno-4-5" href="#__codelineno-4-5"></a>    <span class="k">def</span> <span class="nf">run</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">mainfile</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">archive</span><span class="p">:</span> <span class="n">EntryArchive</span><span class="p">,</span> <span class="n">logger</span><span class="p">):</span>
<a id="__codelineno-4-6" name="__codelineno-4-6" href="#__codelineno-4-6"></a>        <span class="c1"># Log a hello world, just to get us started. TODO remove from an actual parser.</span>
<a id="__codelineno-4-7" name="__codelineno-4-7" href="#__codelineno-4-7"></a>        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;Hello World&#39;</span><span class="p">)</span>
<a id="__codelineno-4-8" name="__codelineno-4-8" href="#__codelineno-4-8"></a>
<a id="__codelineno-4-9" name="__codelineno-4-9" href="#__codelineno-4-9"></a>        <span class="n">run</span> <span class="o">=</span> <span class="n">archive</span><span class="o">.</span><span class="n">m_create</span><span class="p">(</span><span class="n">Run</span><span class="p">)</span>
<a id="__codelineno-4-10" name="__codelineno-4-10" href="#__codelineno-4-10"></a>        <span class="n">run</span><span class="o">.</span><span class="n">program_name</span> <span class="o">=</span> <span class="s1">&#39;EXAMPLE&#39;</span>
</code></pre></div>
<p>A parser is a simple program with a single class. The base class <code>MatchingParser</code>
provides the necessary interface to NOMAD. We provide some basic information
about our parser in the constructor. The <em>main</em> function <code>run</code> simply takes a filepath
and an empty archive as input. Now it's up to you, to open the given file and populate the
given archive accordingly. In the plain <em>hello world</em>, we simple create a log entry,
populate the archive with a <em>root section</em> <code>Run</code>, and set the program name to <code>EXAMPLE</code>.</p>
<p>You can run the parser with the included <code>__main__.py</code>. It takes a file as argument and
you can run it like this:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-5-1" name="__codelineno-5-1" href="#__codelineno-5-1"></a>python<span class="w"> </span>-m<span class="w"> </span>exampleparser<span class="w"> </span>tests/data/example.out
</code></pre></div>
<p>The output should show the log entry and the minimal archive with one <code>section_run</code> and
the respective <code>program_name</code>:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-6-1" name="__codelineno-6-1" href="#__codelineno-6-1"></a><span class="p">{</span>
<a id="__codelineno-6-2" name="__codelineno-6-2" href="#__codelineno-6-2"></a><span class="w">  </span><span class="nt">&quot;section_run&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
<a id="__codelineno-6-3" name="__codelineno-6-3" href="#__codelineno-6-3"></a><span class="w">    </span><span class="p">{</span>
<a id="__codelineno-6-4" name="__codelineno-6-4" href="#__codelineno-6-4"></a><span class="w">      </span><span class="nt">&quot;program_name&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;EXAMPLE&quot;</span>
<a id="__codelineno-6-5" name="__codelineno-6-5" href="#__codelineno-6-5"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-6-6" name="__codelineno-6-6" href="#__codelineno-6-6"></a><span class="w">  </span><span class="p">]</span>
<a id="__codelineno-6-7" name="__codelineno-6-7" href="#__codelineno-6-7"></a><span class="p">}</span>
</code></pre></div>
<h2 id="parsing-test-files">Parsing test files<a class="headerlink" href="#parsing-test-files" title="Permanent link">&para;</a></h2>
<p>Let's do some actual parsing. Here we demonstrate how to parse ASCII files with some
structure information in it, as it is typically used by materials science codes.</p>
<p>On the <code>master</code> branch of the example project, we have a more 'realistic' example:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-7-1" name="__codelineno-7-1" href="#__codelineno-7-1"></a>git<span class="w"> </span>checkout<span class="w"> </span>master
</code></pre></div>
<p>This example imagines a potential code output that looks like this
(<code>tests/data/example.out</code>):</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-8-1" name="__codelineno-8-1" href="#__codelineno-8-1"></a>2020/05/15
<a id="__codelineno-8-2" name="__codelineno-8-2" href="#__codelineno-8-2"></a>               *** super_code v2 ***
<a id="__codelineno-8-3" name="__codelineno-8-3" href="#__codelineno-8-3"></a>
<a id="__codelineno-8-4" name="__codelineno-8-4" href="#__codelineno-8-4"></a>system 1
<a id="__codelineno-8-5" name="__codelineno-8-5" href="#__codelineno-8-5"></a>--------
<a id="__codelineno-8-6" name="__codelineno-8-6" href="#__codelineno-8-6"></a>sites: H(1.23, 0, 0), H(-1.23, 0, 0), O(0, 0.33, 0)
<a id="__codelineno-8-7" name="__codelineno-8-7" href="#__codelineno-8-7"></a>latice: (0, 0, 0), (1, 0, 0), (1, 1, 0)
<a id="__codelineno-8-8" name="__codelineno-8-8" href="#__codelineno-8-8"></a>energy: 1.29372
<a id="__codelineno-8-9" name="__codelineno-8-9" href="#__codelineno-8-9"></a>
<a id="__codelineno-8-10" name="__codelineno-8-10" href="#__codelineno-8-10"></a>*** This was done with magic source                                ***
<a id="__codelineno-8-11" name="__codelineno-8-11" href="#__codelineno-8-11"></a>***                                xÂ°42                            ***
<a id="__codelineno-8-12" name="__codelineno-8-12" href="#__codelineno-8-12"></a>
<a id="__codelineno-8-13" name="__codelineno-8-13" href="#__codelineno-8-13"></a>
<a id="__codelineno-8-14" name="__codelineno-8-14" href="#__codelineno-8-14"></a>system 2
<a id="__codelineno-8-15" name="__codelineno-8-15" href="#__codelineno-8-15"></a>--------
<a id="__codelineno-8-16" name="__codelineno-8-16" href="#__codelineno-8-16"></a>sites: H(1.23, 0, 0), H(-1.23, 0, 0), O(0, 0.33, 0)
<a id="__codelineno-8-17" name="__codelineno-8-17" href="#__codelineno-8-17"></a>cell: (0, 0, 0), (1, 0, 0), (1, 1, 0)
<a id="__codelineno-8-18" name="__codelineno-8-18" href="#__codelineno-8-18"></a>energy: 1.29372
</code></pre></div>
<p>At the top there is some general information. Below that is a list of simulated systems
with "sites" and "lattice" describing the crystal structure, as well as a computed energy
value as an example for a code specific quantity from a 'magic source'.</p>
<p>In order to convert the information from this file into the archive, we first have to
parse the necessary quantities: the date, system, energy, etc. The <code>nomad-lab</code> Python
package provides a <code>text_parser</code> module for declarative parsing of text files. You can
define text file parsers like this:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-9-1" name="__codelineno-9-1" href="#__codelineno-9-1"></a><span class="k">def</span> <span class="nf">str_to_sites</span><span class="p">(</span><span class="n">string</span><span class="p">):</span>
<a id="__codelineno-9-2" name="__codelineno-9-2" href="#__codelineno-9-2"></a>    <span class="n">sym</span><span class="p">,</span> <span class="n">pos</span> <span class="o">=</span> <span class="n">string</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;(&#39;</span><span class="p">)</span>
<a id="__codelineno-9-3" name="__codelineno-9-3" href="#__codelineno-9-3"></a>    <span class="n">pos</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">pos</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;)&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;,&#39;</span><span class="p">)[:</span><span class="mi">3</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">)</span>
<a id="__codelineno-9-4" name="__codelineno-9-4" href="#__codelineno-9-4"></a>    <span class="k">return</span> <span class="n">sym</span><span class="p">,</span> <span class="n">pos</span>
<a id="__codelineno-9-5" name="__codelineno-9-5" href="#__codelineno-9-5"></a>
<a id="__codelineno-9-6" name="__codelineno-9-6" href="#__codelineno-9-6"></a>
<a id="__codelineno-9-7" name="__codelineno-9-7" href="#__codelineno-9-7"></a><span class="n">calculation_parser</span> <span class="o">=</span> <span class="n">UnstructuredTextFileParser</span><span class="p">(</span><span class="n">quantities</span><span class="o">=</span><span class="p">[</span>
<a id="__codelineno-9-8" name="__codelineno-9-8" href="#__codelineno-9-8"></a>    <span class="n">Quantity</span><span class="p">(</span><span class="s1">&#39;sites&#39;</span><span class="p">,</span> <span class="sa">r</span><span class="s1">&#39;([A-Z]\([\d\.\, \-]+\))&#39;</span><span class="p">,</span> <span class="n">str_operation</span><span class="o">=</span><span class="n">str_to_sites</span><span class="p">),</span>
<a id="__codelineno-9-9" name="__codelineno-9-9" href="#__codelineno-9-9"></a>    <span class="n">Quantity</span><span class="p">(</span>
<a id="__codelineno-9-10" name="__codelineno-9-10" href="#__codelineno-9-10"></a>        <span class="n">System</span><span class="o">.</span><span class="n">lattice_vectors</span><span class="p">,</span>
<a id="__codelineno-9-11" name="__codelineno-9-11" href="#__codelineno-9-11"></a>        <span class="sa">r</span><span class="s1">&#39;(?:latice|cell): \((\d)\, (\d), (\d)\)\,?\s*\((\d)\, (\d), (\d)\)\,?\s*\((\d)\, (\d), (\d)\)\,?\s*&#39;</span><span class="p">,</span>
<a id="__codelineno-9-12" name="__codelineno-9-12" href="#__codelineno-9-12"></a>        <span class="n">repeats</span><span class="o">=</span><span class="kc">False</span><span class="p">),</span>
<a id="__codelineno-9-13" name="__codelineno-9-13" href="#__codelineno-9-13"></a>    <span class="n">Quantity</span><span class="p">(</span><span class="s1">&#39;energy&#39;</span><span class="p">,</span> <span class="sa">r</span><span class="s1">&#39;energy: (\d\.\d+)&#39;</span><span class="p">),</span>
<a id="__codelineno-9-14" name="__codelineno-9-14" href="#__codelineno-9-14"></a>    <span class="n">Quantity</span><span class="p">(</span><span class="s1">&#39;magic_source&#39;</span><span class="p">,</span> <span class="sa">r</span><span class="s1">&#39;done with magic source\s*\*</span><span class="si">{3}</span><span class="s1">\s*\*</span><span class="si">{3}</span><span class="s1">\s*[^\d]*(\d+)&#39;</span><span class="p">,</span> <span class="n">repeats</span><span class="o">=</span><span class="kc">False</span><span class="p">)])</span>
<a id="__codelineno-9-15" name="__codelineno-9-15" href="#__codelineno-9-15"></a>
<a id="__codelineno-9-16" name="__codelineno-9-16" href="#__codelineno-9-16"></a><span class="n">mainfile_parser</span> <span class="o">=</span> <span class="n">UnstructuredTextFileParser</span><span class="p">(</span><span class="n">quantities</span><span class="o">=</span><span class="p">[</span>
<a id="__codelineno-9-17" name="__codelineno-9-17" href="#__codelineno-9-17"></a>    <span class="n">Quantity</span><span class="p">(</span><span class="s1">&#39;date&#39;</span><span class="p">,</span> <span class="sa">r</span><span class="s1">&#39;(\d\d\d\d\/\d\d\/\d\d)&#39;</span><span class="p">,</span> <span class="n">repeats</span><span class="o">=</span><span class="kc">False</span><span class="p">),</span>
<a id="__codelineno-9-18" name="__codelineno-9-18" href="#__codelineno-9-18"></a>    <span class="n">Quantity</span><span class="p">(</span><span class="s1">&#39;program_version&#39;</span><span class="p">,</span> <span class="sa">r</span><span class="s1">&#39;super\_code\s*v(\d+)\s*&#39;</span><span class="p">,</span> <span class="n">repeats</span><span class="o">=</span><span class="kc">False</span><span class="p">),</span>
<a id="__codelineno-9-19" name="__codelineno-9-19" href="#__codelineno-9-19"></a>    <span class="n">Quantity</span><span class="p">(</span>
<a id="__codelineno-9-20" name="__codelineno-9-20" href="#__codelineno-9-20"></a>        <span class="s1">&#39;calculation&#39;</span><span class="p">,</span> <span class="sa">r</span><span class="s1">&#39;\s*system \d+([\s\S]+?energy: [\d\.]+)([\s\S]+\*\*\*)*&#39;</span><span class="p">,</span>
<a id="__codelineno-9-21" name="__codelineno-9-21" href="#__codelineno-9-21"></a>        <span class="n">sub_parser</span><span class="o">=</span><span class="n">calculation_parser</span><span class="p">,</span>
<a id="__codelineno-9-22" name="__codelineno-9-22" href="#__codelineno-9-22"></a>        <span class="n">repeats</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<a id="__codelineno-9-23" name="__codelineno-9-23" href="#__codelineno-9-23"></a><span class="p">])</span>
</code></pre></div>
<p>The quantities to be parsed can be specified as a list of <code>Quantity</code> objects with a name
and a <em>regular expression (re)</em> pattern. The matched value should be enclosed in a
group(s) denoted by <code>(...)</code>.
By default, the parser uses the <code>findall</code> method of <code>re</code>, hence overlap between matches is
not tolerated. If overlap cannot be avoided, you should switch to the <code>finditer</code> method by
passing <code>findall=False</code> to the parser. Multiple matches for the quantity are returned if
<code>repeats=True</code> (default). The name, data type, shape and unit for the quantity can also be
initialized by passing a <code>metainfo.Quantity</code>.
An external function <code>str_operation</code> can also be passed to perform more specific string
operations on the matched value. A local parsing on a matched block can be carried out by
nesting a <code>sub_parser</code>. This is also an instance of the <code>UnstructuredTextFileParser</code> with
a list of quantities to parse. To access a parsed quantity, you can use the <code>get</code> method.</p>
<p>We can apply these parser definitions like this:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-10-1" name="__codelineno-10-1" href="#__codelineno-10-1"></a>mainfile_parser.mainfile<span class="w"> </span><span class="o">=</span><span class="w"> </span>mainfile
<a id="__codelineno-10-2" name="__codelineno-10-2" href="#__codelineno-10-2"></a>mainfile_parser.parse<span class="o">()</span>
</code></pre></div>
<p>This will populate the <code>mainfile_parser</code> object with parsed data and it can be accessed
like a Python dict with quantity names as keys:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-11-1" name="__codelineno-11-1" href="#__codelineno-11-1"></a><span class="n">run</span> <span class="o">=</span> <span class="n">archive</span><span class="o">.</span><span class="n">m_create</span><span class="p">(</span><span class="n">Run</span><span class="p">)</span>
<a id="__codelineno-11-2" name="__codelineno-11-2" href="#__codelineno-11-2"></a><span class="n">run</span><span class="o">.</span><span class="n">program_name</span> <span class="o">=</span> <span class="s1">&#39;super_code&#39;</span>
<a id="__codelineno-11-3" name="__codelineno-11-3" href="#__codelineno-11-3"></a><span class="n">run</span><span class="o">.</span><span class="n">program_version</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">mainfile_parser</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;program_version&#39;</span><span class="p">))</span>
<a id="__codelineno-11-4" name="__codelineno-11-4" href="#__codelineno-11-4"></a><span class="n">date</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">strptime</span><span class="p">(</span>
<a id="__codelineno-11-5" name="__codelineno-11-5" href="#__codelineno-11-5"></a>    <span class="n">mainfile_parser</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;date&#39;</span><span class="p">),</span>
<a id="__codelineno-11-6" name="__codelineno-11-6" href="#__codelineno-11-6"></a>    <span class="s1">&#39;%Y/%m/</span><span class="si">%d</span><span class="s1">&#39;</span><span class="p">)</span> <span class="o">-</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="p">(</span><span class="mi">1970</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
<a id="__codelineno-11-7" name="__codelineno-11-7" href="#__codelineno-11-7"></a><span class="n">run</span><span class="o">.</span><span class="n">program_compilation_datetime</span> <span class="o">=</span> <span class="n">date</span><span class="o">.</span><span class="n">total_seconds</span><span class="p">()</span>
<a id="__codelineno-11-8" name="__codelineno-11-8" href="#__codelineno-11-8"></a>
<a id="__codelineno-11-9" name="__codelineno-11-9" href="#__codelineno-11-9"></a><span class="k">for</span> <span class="n">calculation</span> <span class="ow">in</span> <span class="n">mainfile_parser</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;calculation&#39;</span><span class="p">):</span>
<a id="__codelineno-11-10" name="__codelineno-11-10" href="#__codelineno-11-10"></a>    <span class="n">system</span> <span class="o">=</span> <span class="n">run</span><span class="o">.</span><span class="n">m_create</span><span class="p">(</span><span class="n">System</span><span class="p">)</span>
<a id="__codelineno-11-11" name="__codelineno-11-11" href="#__codelineno-11-11"></a>
<a id="__codelineno-11-12" name="__codelineno-11-12" href="#__codelineno-11-12"></a>    <span class="n">system</span><span class="o">.</span><span class="n">lattice_vectors</span> <span class="o">=</span> <span class="n">calculation</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;lattice_vectors&#39;</span><span class="p">)</span>
<a id="__codelineno-11-13" name="__codelineno-11-13" href="#__codelineno-11-13"></a>    <span class="n">sites</span> <span class="o">=</span> <span class="n">calculation</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;sites&#39;</span><span class="p">)</span>
<a id="__codelineno-11-14" name="__codelineno-11-14" href="#__codelineno-11-14"></a>    <span class="n">system</span><span class="o">.</span><span class="n">atom_labels</span> <span class="o">=</span> <span class="p">[</span><span class="n">site</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">site</span> <span class="ow">in</span> <span class="n">sites</span><span class="p">]</span>
<a id="__codelineno-11-15" name="__codelineno-11-15" href="#__codelineno-11-15"></a>    <span class="n">system</span><span class="o">.</span><span class="n">atom_positions</span> <span class="o">=</span> <span class="p">[</span><span class="n">site</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="k">for</span> <span class="n">site</span> <span class="ow">in</span> <span class="n">sites</span><span class="p">]</span>
<a id="__codelineno-11-16" name="__codelineno-11-16" href="#__codelineno-11-16"></a>
<a id="__codelineno-11-17" name="__codelineno-11-17" href="#__codelineno-11-17"></a>    <span class="n">scc</span> <span class="o">=</span> <span class="n">run</span><span class="o">.</span><span class="n">m_create</span><span class="p">(</span><span class="n">SCC</span><span class="p">)</span>
<a id="__codelineno-11-18" name="__codelineno-11-18" href="#__codelineno-11-18"></a>    <span class="n">scc</span><span class="o">.</span><span class="n">single_configuration_calculation_to_system_ref</span> <span class="o">=</span> <span class="n">system</span>
<a id="__codelineno-11-19" name="__codelineno-11-19" href="#__codelineno-11-19"></a>    <span class="n">scc</span><span class="o">.</span><span class="n">energy_total</span> <span class="o">=</span> <span class="n">calculation</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;energy&#39;</span><span class="p">)</span> <span class="o">*</span> <span class="n">units</span><span class="o">.</span><span class="n">eV</span>
<a id="__codelineno-11-20" name="__codelineno-11-20" href="#__codelineno-11-20"></a>    <span class="n">scc</span><span class="o">.</span><span class="n">single_configuration_calculation_to_system_ref</span> <span class="o">=</span> <span class="n">system</span>
<a id="__codelineno-11-21" name="__codelineno-11-21" href="#__codelineno-11-21"></a>    <span class="n">magic_source</span> <span class="o">=</span> <span class="n">calculation</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;magic_source&#39;</span><span class="p">)</span>
<a id="__codelineno-11-22" name="__codelineno-11-22" href="#__codelineno-11-22"></a>    <span class="k">if</span> <span class="n">magic_source</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-11-23" name="__codelineno-11-23" href="#__codelineno-11-23"></a>        <span class="n">scc</span><span class="o">.</span><span class="n">x_example_magic_value</span> <span class="o">=</span> <span class="n">magic_source</span>
</code></pre></div>
<p>You can still run the parser on the given example file:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-12-1" name="__codelineno-12-1" href="#__codelineno-12-1"></a>python<span class="w"> </span>-m<span class="w"> </span>exampleparser<span class="w"> </span>tests/data/example.out
</code></pre></div>
<p>Now you should get a more comprehensive archive with all the provided information from
the <code>example.out</code> file.</p>
<h2 id="extending-the-metainfo">Extending the Metainfo<a class="headerlink" href="#extending-the-metainfo" title="Permanent link">&para;</a></h2>
<p>The NOMAD Metainfo defines the schema of each archive. There are predefined schemas for
all domains (e.g. <code>common_dft.py</code> for electronic structure codes; <code>common_ems.py</code> for
experimental data, etc.). The sections <code>Run</code>, <code>System</code>, and the single configuration
calculations (<code>SCC</code>) in the example are taken from <code>common_dft.py</code>. While this covers most
of the data usually provided in code input/output files, some data is typically
format-specific and applies only to a certain code or method. For these cases, we allow to
extend the Metainfo like this (<code>exampleparser/metainfo.py</code>):</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-13-1" name="__codelineno-13-1" href="#__codelineno-13-1"></a><span class="c1"># We extend the existing common definition of a section &quot;single configuration calculation&quot;</span>
<a id="__codelineno-13-2" name="__codelineno-13-2" href="#__codelineno-13-2"></a><span class="k">class</span> <span class="nc">ExampleSCC</span><span class="p">(</span><span class="n">SCC</span><span class="p">):</span>
<a id="__codelineno-13-3" name="__codelineno-13-3" href="#__codelineno-13-3"></a>    <span class="c1"># We alter the default base class behavior to add all definitions to the existing</span>
<a id="__codelineno-13-4" name="__codelineno-13-4" href="#__codelineno-13-4"></a>    <span class="c1"># base class instead of inheriting from the base class</span>
<a id="__codelineno-13-5" name="__codelineno-13-5" href="#__codelineno-13-5"></a>    <span class="n">m_def</span> <span class="o">=</span> <span class="n">Section</span><span class="p">(</span><span class="n">extends_base_section</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<a id="__codelineno-13-6" name="__codelineno-13-6" href="#__codelineno-13-6"></a>
<a id="__codelineno-13-7" name="__codelineno-13-7" href="#__codelineno-13-7"></a>    <span class="c1"># We define an additional example quantity. Use the prefix x_&lt;parsername&gt;_ to denote</span>
<a id="__codelineno-13-8" name="__codelineno-13-8" href="#__codelineno-13-8"></a>    <span class="c1"># non common quantities.</span>
<a id="__codelineno-13-9" name="__codelineno-13-9" href="#__codelineno-13-9"></a>    <span class="n">x_example_magic_value</span> <span class="o">=</span> <span class="n">Quantity</span><span class="p">(</span><span class="nb">type</span><span class="o">=</span><span class="nb">int</span><span class="p">,</span> <span class="n">description</span><span class="o">=</span><span class="s1">&#39;The magic value from a magic source.&#39;</span><span class="p">)</span>
</code></pre></div>
<h2 id="testing-a-parser">Testing a parser<a class="headerlink" href="#testing-a-parser" title="Permanent link">&para;</a></h2>
<p>Until now, we simply run our parser on some example data and manually observed the output.
To improve the parser quality and ease the further development, you should get into the
habit of testing the parser.</p>
<p>We use the Python unit test framework <code>pytest</code>:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-14-1" name="__codelineno-14-1" href="#__codelineno-14-1"></a>pip<span class="w"> </span>install<span class="w"> </span>pytest
</code></pre></div>
<p>A typical test would take one example file, parse it, and check assertions about the
output:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-15-1" name="__codelineno-15-1" href="#__codelineno-15-1"></a><span class="k">def</span> <span class="nf">test_example</span><span class="p">():</span>
<a id="__codelineno-15-2" name="__codelineno-15-2" href="#__codelineno-15-2"></a>    <span class="n">parser</span> <span class="o">=</span> <span class="n">rExampleParser</span><span class="p">()</span>
<a id="__codelineno-15-3" name="__codelineno-15-3" href="#__codelineno-15-3"></a>    <span class="n">archive</span> <span class="o">=</span> <span class="n">EntryArchive</span><span class="p">()</span>
<a id="__codelineno-15-4" name="__codelineno-15-4" href="#__codelineno-15-4"></a>    <span class="n">parser</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="s1">&#39;tests/data/example.out&#39;</span><span class="p">,</span> <span class="n">archive</span><span class="p">,</span> <span class="n">logging</span><span class="p">)</span>
<a id="__codelineno-15-5" name="__codelineno-15-5" href="#__codelineno-15-5"></a>
<a id="__codelineno-15-6" name="__codelineno-15-6" href="#__codelineno-15-6"></a>    <span class="n">run</span> <span class="o">=</span> <span class="n">archive</span><span class="o">.</span><span class="n">section_run</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<a id="__codelineno-15-7" name="__codelineno-15-7" href="#__codelineno-15-7"></a>    <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">run</span><span class="o">.</span><span class="n">section_system</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span>
<a id="__codelineno-15-8" name="__codelineno-15-8" href="#__codelineno-15-8"></a>    <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">run</span><span class="o">.</span><span class="n">section_single_configuration_calculation</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span>
<a id="__codelineno-15-9" name="__codelineno-15-9" href="#__codelineno-15-9"></a>    <span class="k">assert</span> <span class="n">run</span><span class="o">.</span><span class="n">section_single_configuration_calculation</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">x_example_magic_value</span> <span class="o">==</span> <span class="mi">42</span>
</code></pre></div>
<p>You can run all tests in the <code>tests</code> directory like this:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-16-1" name="__codelineno-16-1" href="#__codelineno-16-1"></a>pytest<span class="w"> </span>-svx<span class="w"> </span>tests
</code></pre></div>
<p>You should define individual test cases with example files that demonstrate certain
features of the underlying code/format.</p>
<h2 id="structured-data-files-with-numpsy">Structured data files with NumPsy<a class="headerlink" href="#structured-data-files-with-numpsy" title="Permanent link">&para;</a></h2>
<p>The <code>DataTextParser</code> uses the <code>numpy.loadtxt</code> function to load an structured data file.
The loaded data can be accessed from property <code>data</code>.</p>
<h2 id="xml-parser">XML Parser<a class="headerlink" href="#xml-parser" title="Permanent link">&para;</a></h2>
<p>The <code>XMLParser</code> uses the ElementTree module to parse an XML file. The <code>parse</code> method of
the parser takes in an XPath-style key to access individual quantities. By default,
automatic data type conversion is performed, which can be switched off by setting
<code>convert=False</code>.</p>
<h2 id="add-the-parser-to-nomad">Add the parser to NOMAD<a class="headerlink" href="#add-the-parser-to-nomad" title="Permanent link">&para;</a></h2>
<p>NOMAD has to manage multiple parsers and must decide during processing which parsers
to run on which files. To decide what parser is used, NOMAD processing relies on specific
parser attributes.</p>
<p>Consider the example where we use the <code>MatchingParser</code> constructor to add additional
attributes that determine for which files the parser is intended for:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-17-1" name="__codelineno-17-1" href="#__codelineno-17-1"></a><span class="k">class</span> <span class="nc">ExampleParser</span><span class="p">(</span><span class="n">MatchingParser</span><span class="p">):</span>
<a id="__codelineno-17-2" name="__codelineno-17-2" href="#__codelineno-17-2"></a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<a id="__codelineno-17-3" name="__codelineno-17-3" href="#__codelineno-17-3"></a>        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span>
<a id="__codelineno-17-4" name="__codelineno-17-4" href="#__codelineno-17-4"></a>            <span class="n">name</span><span class="o">=</span><span class="s1">&#39;parsers/example&#39;</span><span class="p">,</span> <span class="n">code_name</span><span class="o">=</span><span class="s1">&#39;EXAMPLE&#39;</span><span class="p">,</span> <span class="n">code_homepage</span><span class="o">=</span><span class="s1">&#39;https://www.example.eu/&#39;</span><span class="p">,</span>
<a id="__codelineno-17-5" name="__codelineno-17-5" href="#__codelineno-17-5"></a>            <span class="n">mainfile_mime_re</span><span class="o">=</span><span class="sa">r</span><span class="s1">&#39;(application/.*)|(text/.*)&#39;</span><span class="p">,</span>
<a id="__codelineno-17-6" name="__codelineno-17-6" href="#__codelineno-17-6"></a>            <span class="n">mainfile_contents_re</span><span class="o">=</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;^\s*#\s*This is example output&#39;</span><span class="p">),</span>
<a id="__codelineno-17-7" name="__codelineno-17-7" href="#__codelineno-17-7"></a>            <span class="n">supported_compressions</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;gz&quot;</span><span class="p">,</span> <span class="s2">&quot;bz2&quot;</span><span class="p">,</span> <span class="s2">&quot;xz&quot;</span><span class="p">],</span>
<a id="__codelineno-17-8" name="__codelineno-17-8" href="#__codelineno-17-8"></a>            <span class="n">mainfile_alternative</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
<a id="__codelineno-17-9" name="__codelineno-17-9" href="#__codelineno-17-9"></a>            <span class="n">mainfile_contents_dict</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;program&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;version&#39;</span><span class="p">:</span> <span class="s1">&#39;1&#39;</span><span class="p">,</span> <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;EXAMPLE&#39;</span><span class="p">}})</span>
</code></pre></div>
<ul>
<li>
<p><code>mainfile_mime_re</code>: A regular expression on the MIME type of files. The parser is run
  only on files with matching MIME type. The MIME type is <em>guessed</em> with libmagic.</p>
</li>
<li>
<p><code>mainfile_contents_re</code>: A regular expression that is applied to the first 4k of a file.
  The parser is run only on files where this matches.</p>
</li>
<li>
<p><code>mainfile_name_re</code>: A regular expression that can be used to match against the name and
  path of the file.</p>
</li>
<li>
<p><code>supported compressions</code>: A list of [<code>gz</code>, <code>bz2</code>] if the parser supports compressed
  files.</p>
</li>
<li>
<p><code>mainfile_alternative</code>: If <code>True</code>, a file is <code>mainfile</code> unless another file in the same
  directory matches <code>mainfile_name_re</code>.</p>
</li>
<li>
<p><code>mainfile_contents_dict</code>: A dictionary to match the contents of the file. If provided,
  it will load the file and match the value of the key(s) provided.</p>
</li>
</ul>
<p>Not all of these attributes have to be used. Those that are given must all match in order
to use the parser on a file.</p>
<p>The NOMAD infrastructure keeps a list of parser objects (in
<code>nomad/parsing/parsers.py::parsers</code>). These parsers are considered in the order they
appear in the list. The first matching parser is used to parse a given file.</p>
<p>While each parser project should provide its own tests, a single example file should be
added to the infrastructure parser tests (<code>tests/parsing/test_parsing.py</code>).</p>
<p>Once the parser is added, it becomes also available through the command line interface and
normalizers are applied as well:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-18-1" name="__codelineno-18-1" href="#__codelineno-18-1"></a>nomad<span class="w"> </span>parse<span class="w"> </span>tests/data/example.out
</code></pre></div>
<h2 id="developing-an-existing-parser">Developing an existing parser<a class="headerlink" href="#developing-an-existing-parser" title="Permanent link">&para;</a></h2>
<p>To refine an existing parser, you should install the parser via the <code>nomad-lab</code> package:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-19-1" name="__codelineno-19-1" href="#__codelineno-19-1"></a>pip<span class="w"> </span>install<span class="w"> </span>nomad-lab
</code></pre></div>
<p>Clone the parser project:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-20-1" name="__codelineno-20-1" href="#__codelineno-20-1"></a>git<span class="w"> </span>clone<span class="w"> </span>&lt;parser-project-url&gt;
<a id="__codelineno-20-2" name="__codelineno-20-2" href="#__codelineno-20-2"></a><span class="nb">cd</span><span class="w"> </span>&lt;parser-dir&gt;
</code></pre></div>
<p>Either remove the installed parser and <code>pip install</code> the cloned version:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-21-1" name="__codelineno-21-1" href="#__codelineno-21-1"></a>rm<span class="w"> </span>-rf<span class="w"> </span>&lt;path-to-your-python-env&gt;/lib/python3.9/site-packages/&lt;parser-module-name&gt;
<a id="__codelineno-21-2" name="__codelineno-21-2" href="#__codelineno-21-2"></a>pip<span class="w"> </span>install<span class="w"> </span>-e<span class="w"> </span>.
</code></pre></div>
<p>Or set <code>PYTHONPATH</code> so that the cloned code takes precedence over the installed code:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-22-1" name="__codelineno-22-1" href="#__codelineno-22-1"></a><span class="nv">PYTHONPATH</span><span class="o">=</span>.<span class="w"> </span>nomad<span class="w"> </span>parse<span class="w"> </span>&lt;path-to-example-file&gt;
</code></pre></div>
<p>Alternatively, you can also do a full developer setup of the NOMAD infrastructure and
enhance the parser there.</p>

              
            </article>
          </div>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
    <nav class="md-footer__inner md-grid" aria-label="Footer">
      
        
        <a href="search.html" class="md-footer__link md-footer__link--prev" aria-label="Previous: How to extend the search" rel="prev">
          <div class="md-footer__button md-icon">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
          </div>
          <div class="md-footer__title">
            <div class="md-ellipsis">
              <span class="md-footer__direction">
                Previous
              </span>
              How to extend the search
            </div>
          </div>
        </a>
      
      
        
        <a href="normalizers.html" class="md-footer__link md-footer__link--next" aria-label="Next: How to write a normalizer" rel="next">
          <div class="md-footer__title">
            <div class="md-ellipsis">
              <span class="md-footer__direction">
                Next
              </span>
              How to write a normalizer
            </div>
          </div>
          <div class="md-footer__button md-icon">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11H4z"/></svg>
          </div>
        </a>
      
    </nav>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    <script id="__config" type="application/json">{"base": "..", "features": ["navigation.instant"], "translations": {"clipboard.copy": "Copy to clipboard", "clipboard.copied": "Copied to clipboard", "search.config.lang": "en", "search.config.pipeline": "trimmer, stopWordFilter", "search.config.separator": "[\\s\\-]+", "search.placeholder": "Search", "search.result.placeholder": "Type to start searching", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.term.missing": "Missing", "select.version.title": "Select version"}, "search": "../assets/javascripts/workers/search.c7dec7e7.min.js"}</script>
    
    
      <script src="../assets/javascripts/bundle.da79ceb7.min.js"></script>
      
        <script src="../javascript.js"></script>
      
        <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
      
        <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
      
    
  </body>
</html>